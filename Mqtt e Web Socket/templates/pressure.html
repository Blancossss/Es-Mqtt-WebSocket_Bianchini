<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Sensor Dashboard</title>
</head>
<body>

<h1 id="title" >Dashboard Sensore â€“ Pressione</h1>

<select name="semsors" id="sensors">
    <option value="pressure">pressure</option>
    <option value="temperature">temperature</option>
    <option value="humidity">humidity</option>
</select>
<button type="button" onclick=getType()>Confermo</button>

<h3>Dati grezzi (MQTT)</h3>
<pre id="raw">---</pre>

<h3>Dati formattati</h3>
<p id="formatted">---</p>

<script>
//----Scelta sensore-------------------------------------------------------------------------------------------
    async function getType(){
        const sensor = document.getElementById("sensors").value;
        location.href = sensor+".html" ;
    }


//----raccolta dati---------------------------------------------------------------------------------------------
const ws = new WebSocket("ws://localhost:8888/ws");

const raw = document.getElementById("raw");
const formatted = document.getElementById("formatted");

ws.onopen = () => {
    console.log("WebSocket aperto");
};

ws.onmessage = (event) => {
    const msg = JSON.parse(event.data);

    // gestisce solo messaggi di tipo sensore
    if (msg.type !== "sensor") return;

    const data = msg.data;

    // filtra solo il sensore pressione
    if (data.sensor !== "pressure") return;

    const time = new Date().toLocaleTimeString();

    // dati grezzi
    raw.textContent = JSON.stringify(data, null, 2);

    // dati formattati
    formatted.textContent =
        `Pressione: ${data.value} ${data.unit} (ore ${time})`;
};

ws.onclose = () => {
    console.log("WebSocket chiuso");
};
</script>
